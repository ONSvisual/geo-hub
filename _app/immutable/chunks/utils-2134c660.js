const X="https://onsvisual.github.io/geo-hub",M="https://cdn.ons.gov.uk/maptiles/ap-geos/v1",S={E06:{label:"unitary authority",plural:"unitary authorities"},W06:{label:"unitary authority",plural:"unitary authorities"},E07:{label:"non-metropolitan district",plural:"non-metropolitan districts"},E08:{label:"metropolitan district",plural:"metropolitan districts"},E09:{label:"borough",plural:"boroughs"},E10:{label:"county",plural:"counties"},E11:{label:"metropolitan county",plural:"metropolital counties"}},D=[{key:"ew",codes:["K04"],source:{type:"geojson",promoteId:"areacd"}},{key:"ctry",codes:["E92","W92"],label:"country",plural:"countries",source:{type:"geojson",promoteId:"areacd"}},{key:"rgn",codes:["E12"],label:"region",plural:"regions",source:{type:"geojson",promoteId:"areacd"}},{key:"cty",codes:["E10","E11","E06","W06","E09"],label:"county/unitary authority",plural:"counties/unitary authorities",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/cty/v1/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:4}},{key:"lad",codes:["E06","E07","E08","E09","W06"],label:"district",plural:"districts",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/authorities-ew/v2/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:4}},{key:"wpc",codes:["E14","W07"],label:"parliamentary constituency",plural:"parliamentary constituencies",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2010/wpc/v1/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:4}},{key:"wd",codes:["E05","W05"],label:"ward",plural:"wards",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2022/wd/v1/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:6}},{key:"par",codes:["E04","W04"],label:"parish",plural:"parishes",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2022/par/v1/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:6}},{key:"msoa",codes:["E02","W02"],label:"MSOA",plural:"MSOAs",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/msoa/v2/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:6}},{key:"lsoa",codes:["E01","W01"],label:"LSOA",plural:"LSOAs",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/lsoa/v2/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:7}},{key:"oa",codes:["E00","W00"],label:"output area",plural:"output areas",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/oa/v2/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:8}}],N=(()=>{let e={};return D.forEach(t=>t.codes.forEach(r=>e[r]=t)),e})();(()=>{let e={};return D.forEach(t=>e[t.key]=t),e})();var R={},A={},z=34,k=10,I=13;function L(e){return new Function("d","return {"+e.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function P(e,t){var r=L(e);return function(a,o){return t(r(a),o,e)}}function U(e){var t=Object.create(null),r=[];return e.forEach(function(a){for(var o in a)o in t||r.push(t[o]=o)}),r}function d(e,t){var r=e+"",a=r.length;return a<t?new Array(t-a+1).join(0)+r:r}function F(e){return e<0?"-"+d(-e,6):e>9999?"+"+d(e,6):d(e,4)}function x(e){var t=e.getUTCHours(),r=e.getUTCMinutes(),a=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":F(e.getUTCFullYear())+"-"+d(e.getUTCMonth()+1,2)+"-"+d(e.getUTCDate(),2)+(o?"T"+d(t,2)+":"+d(r,2)+":"+d(a,2)+"."+d(o,3)+"Z":a?"T"+d(t,2)+":"+d(r,2)+":"+d(a,2)+"Z":r||t?"T"+d(t,2)+":"+d(r,2)+"Z":"")}function $(e){var t=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function a(n,i){var p,u,f=o(n,function(b,g){if(p)return p(b,g-1);u=b,p=i?P(b,i):L(b)});return f.columns=u||[],f}function o(n,i){var p=[],u=n.length,f=0,b=0,g,j=u<=0,E=!1;n.charCodeAt(u-1)===k&&--u,n.charCodeAt(u-1)===I&&--u;function W(){if(j)return A;if(E)return E=!1,R;var C,T=f,v;if(n.charCodeAt(T)===z){for(;f++<u&&n.charCodeAt(f)!==z||n.charCodeAt(++f)===z;);return(C=f)>=u?j=!0:(v=n.charCodeAt(f++))===k?E=!0:v===I&&(E=!0,n.charCodeAt(f)===k&&++f),n.slice(T+1,C-1).replace(/""/g,'"')}for(;f<u;){if((v=n.charCodeAt(C=f++))===k)E=!0;else if(v===I)E=!0,n.charCodeAt(f)===k&&++f;else if(v!==r)continue;return n.slice(T,C)}return j=!0,n.slice(T,u)}for(;(g=W())!==A;){for(var w=[];g!==R&&g!==A;)w.push(g),g=W();i&&(w=i(w,b++))==null||p.push(w)}return p}function l(n,i){return n.map(function(p){return i.map(function(u){return s(p[u])}).join(e)})}function c(n,i){return i==null&&(i=U(n)),[i.map(s).join(e)].concat(l(n,i)).join(`
`)}function y(n,i){return i==null&&(i=U(n)),l(n,i).join(`
`)}function h(n){return n.map(m).join(`
`)}function m(n){return n.map(s).join(e)}function s(n){return n==null?"":n instanceof Date?x(n):t.test(n+="")?'"'+n.replace(/"/g,'""')+'"':n}return{parse:a,parseRows:o,format:c,formatBody:y,formatRows:h,formatRow:m,formatValue:s}}var Z=$(","),B=Z.parse;function G(e){for(var t in e){var r=e[t].trim(),a,o;if(!r)r=null;else if(r==="true")r=!0;else if(r==="false")r=!1;else if(r==="NaN")r=NaN;else if(!isNaN(a=+r))r=a;else if(o=r.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/))H&&!!o[4]&&!o[7]&&(r=r.replace(/-/g,"/").replace(/T/," ")),r=new Date(r);else continue;e[t]=r}return e}const H=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function J(e){return e}function K(e){if(e==null)return J;var t,r,a=e.scale[0],o=e.scale[1],l=e.translate[0],c=e.translate[1];return function(y,h){h||(t=r=0);var m=2,s=y.length,n=new Array(s);for(n[0]=(t+=y[0])*a+l,n[1]=(r+=y[1])*o+c;m<s;)n[m]=y[m],++m;return n}}function V(e,t){for(var r,a=e.length,o=a-t;o<--a;)r=e[o],e[o++]=e[a],e[a]=r}function Y(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(r){return O(e,r)})}:O(e,t)}function O(e,t){var r=t.id,a=t.bbox,o=t.properties==null?{}:t.properties,l=Q(e,t);return r==null&&a==null?{type:"Feature",properties:o,geometry:l}:a==null?{type:"Feature",id:r,properties:o,geometry:l}:{type:"Feature",id:r,bbox:a,properties:o,geometry:l}}function Q(e,t){var r=K(e.transform),a=e.arcs;function o(s,n){n.length&&n.pop();for(var i=a[s<0?~s:s],p=0,u=i.length;p<u;++p)n.push(r(i[p],p));s<0&&V(n,u)}function l(s){return r(s)}function c(s){for(var n=[],i=0,p=s.length;i<p;++i)o(s[i],n);return n.length<2&&n.push(n[0]),n}function y(s){for(var n=c(s);n.length<4;)n.push(n[0]);return n}function h(s){return s.map(y)}function m(s){var n=s.type,i;switch(n){case"GeometryCollection":return{type:n,geometries:s.geometries.map(m)};case"Point":i=l(s.coordinates);break;case"MultiPoint":i=s.coordinates.map(l);break;case"LineString":i=c(s.arcs);break;case"MultiLineString":i=s.arcs.map(c);break;case"Polygon":i=h(s.arcs);break;case"MultiPolygon":i=s.arcs.map(h);break;default:return null}return{type:n,coordinates:i}}return m(t)}async function _(e,t=window.fetch){let a=await(await t(e)).text(),o=B(a,G),l=o.columns.filter(c=>o[0][c].includes("|"));return o.forEach((c,y)=>{l.forEach(h=>{c[h]=c[h].split("|")})}),o}async function ee(e,t=window.fetch){try{let r=e.slice(0,3),o=await(await t(`${M}/${r}/${e}.json`)).json();S[r]&&(o.properties.typenm=S[r].label);let l=o.properties.children[0]?Array.from(new Set(o.properties.children.map(c=>c.areacd.slice(0,3)))):null;return o.properties.childTypes=l?Array.from(new Set(l.map(c=>N[c]))):[],r==="E12"&&(o.properties.childTypes=o.properties.childTypes.filter(c=>c.key!=="lad"),e==="E12000007"&&(o.properties.childTypes=[{key:"lad",codes:["E09"],label:"borough",plural:"boroughs"},...o.properties.childTypes])),{place:o.properties,type:N[r]}}catch{return{place:null,type:null}}}function q(e,t=null){let r=e.hclnm?e.hclnm:e.areanm?e.areanm:e.areacd,a=r.startsWith("Isle"),o=e.areacd.slice(0,3)==="E12"&&!["E12000003","E12000007"].includes(e.areacd);return r=r.replace("&","and"),["in","the"].includes(t)&&(a||o)&&(r="the "+r),t==="in"&&(a?r="on "+r:r="in "+r),r}function re(e,t){for(const r of t){let a=r.areacd.slice(0,3);if(e.includes(a))return r.groupcd=N[a].key,[r]}return[]}function te(e,t){let r=e,a=e.match(new RegExp(/\{(.*?)\}/g));return Array.isArray(a)&&a.forEach(o=>{if(o.includes("name")){let l=o.slice(1,-1).split(",")[1];r=r.replace(o,q(t,l))}else r=r.replace(o,t[o.slice(1,-1)])}),r}function ne(e){return!e.startsWith("unit")&&["a","e","i","o","u"].includes(e.slice(0,1).toLowerCase())?"an "+e:"a "+e}function oe(e){return["K04","E92","W92","E10","E11","E12","E06","E07","E08","E09","W06","E14","W07"].includes(e.slice(0,3))?e+"/":"areas/?code="+e}function ae(e,t){return Y(e,t)}function ie(e){return e[0].toUpperCase()+e.slice(1)}export{S as a,N as b,ie as c,X as d,q as e,ee as f,_ as g,ne as h,D as i,ae as j,re as k,oe as m,te as p};
