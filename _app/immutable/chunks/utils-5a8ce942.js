const X="https://www.ons.gov.uk/visualisations/areas",P="https://cdn.ons.gov.uk/maptiles/ap-geos/v1",I={E06:{label:"unitary authority",plural:"unitary authorities"},W06:{label:"unitary authority",plural:"unitary authorities"},E07:{label:"non-metropolitan district",plural:"non-metropolitan districts"},E08:{label:"metropolitan district",plural:"metropolitan districts"},E09:{label:"borough",plural:"boroughs"},E10:{label:"county",plural:"counties"},E11:{label:"metropolitan county",plural:"metropolital counties"}},U=[{key:"ew",codes:["K04"],source:{type:"geojson",promoteId:"areacd"}},{key:"ctry",codes:["E92","W92"],pcio:"country",label:"country",plural:"countries",source:{type:"geojson",promoteId:"areacd"}},{key:"rgn",codes:["E12"],pcio:"region",label:"region",plural:"regions",source:{type:"geojson",promoteId:"areacd"}},{key:"cty",codes:["E10","E11","E06","W06","E09"],pcio:"admin_county",label:"county/unitary authority",plural:"counties/unitary authorities",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/cty/v1/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:4}},{key:"lad",codes:["E06","E07","E08","E09","W06"],pcio:"admin_district",label:"district",plural:"districts",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/authorities-ew/v2/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:4}},{key:"wpc",codes:["E14","W07"],pcio:"parliamentary_constituency",label:"parliamentary constituency",plural:"parliamentary constituencies",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2010/wpc/v1/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:4}},{key:"wd",codes:["E05","W05"],pcio:"admin_ward",label:"ward",plural:"wards",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2022/wd/v1/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:6}},{key:"par",codes:["E04","W04"],pcio:"parish",label:"parish",plural:"parishes",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2022/par/v1/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:6}},{key:"msoa",codes:["E02","W02"],pcio:"msoa",label:"MSOA",plural:"MSOAs",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/msoa/v2/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:6}},{key:"lsoa",codes:["E01","W01"],pcio:"lsoa",label:"LSOA",plural:"LSOAs",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/lsoa/v2/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:7}},{key:"oa",codes:["E00","W00"],label:"output area",plural:"output areas",source:{type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/oa/v2/boundaries/{z}/{x}/{y}.pbf",promoteId:"areacd",minzoom:8}}],S=(()=>{let e={};return U.forEach(t=>t.codes.forEach(r=>e[r]=t)),e})();(()=>{let e={};return U.forEach(t=>e[t.key]=t),e})();const ee={England:"E92000001",Wales:"W92000004","North East":"E12000001","North West":"E12000002","Yorkshire and The Humber":"E12000003","East Midlands":"E12000004","West Midlands":"E12000005","East of England":"E12000006",London:"E12000007","South East":"E12000008","South West":"E12000009"};var O={},j={},W=34,k=10,N=13;function D(e){return new Function("d","return {"+e.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function F(e,t){var r=D(e);return function(o,n){return t(r(o),n,e)}}function L(e){var t=Object.create(null),r=[];return e.forEach(function(o){for(var n in o)n in t||r.push(t[n]=n)}),r}function f(e,t){var r=e+"",o=r.length;return o<t?new Array(t-o+1).join(0)+r:r}function x(e){return e<0?"-"+f(-e,6):e>9999?"+"+f(e,6):f(e,4)}function $(e){var t=e.getUTCHours(),r=e.getUTCMinutes(),o=e.getUTCSeconds(),n=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":x(e.getUTCFullYear())+"-"+f(e.getUTCMonth()+1,2)+"-"+f(e.getUTCDate(),2)+(n?"T"+f(t,2)+":"+f(r,2)+":"+f(o,2)+"."+f(n,3)+"Z":o?"T"+f(t,2)+":"+f(r,2)+":"+f(o,2)+"Z":r||t?"T"+f(t,2)+":"+f(r,2)+"Z":"")}function H(e){var t=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function o(a,i){var p,c,d=n(a,function(g,E){if(p)return p(g,E-1);c=g,p=i?F(g,i):D(g)});return d.columns=c||[],d}function n(a,i){var p=[],c=a.length,d=0,g=0,E,T=c<=0,b=!1;a.charCodeAt(c-1)===k&&--c,a.charCodeAt(c-1)===N&&--c;function z(){if(T)return j;if(b)return b=!1,O;var C,A=d,v;if(a.charCodeAt(A)===W){for(;d++<c&&a.charCodeAt(d)!==W||a.charCodeAt(++d)===W;);return(C=d)>=c?T=!0:(v=a.charCodeAt(d++))===k?b=!0:v===N&&(b=!0,a.charCodeAt(d)===k&&++d),a.slice(A+1,C-1).replace(/""/g,'"')}for(;d<c;){if((v=a.charCodeAt(C=d++))===k)b=!0;else if(v===N)b=!0,a.charCodeAt(d)===k&&++d;else if(v!==r)continue;return a.slice(A,C)}return T=!0,a.slice(A,c)}for(;(E=z())!==j;){for(var w=[];E!==O&&E!==j;)w.push(E),E=z();i&&(w=i(w,g++))==null||p.push(w)}return p}function u(a,i){return a.map(function(p){return i.map(function(c){return s(p[c])}).join(e)})}function l(a,i){return i==null&&(i=L(a)),[i.map(s).join(e)].concat(u(a,i)).join(`
`)}function m(a,i){return i==null&&(i=L(a)),u(a,i).join(`
`)}function y(a){return a.map(h).join(`
`)}function h(a){return a.map(s).join(e)}function s(a){return a==null?"":a instanceof Date?$(a):t.test(a+="")?'"'+a.replace(/"/g,'""')+'"':a}return{parse:o,parseRows:n,format:l,formatBody:m,formatRows:y,formatRow:h,formatValue:s}}var Z=H(","),_=Z.parse;function B(e){for(var t in e){var r=e[t].trim(),o,n;if(!r)r=null;else if(r==="true")r=!0;else if(r==="false")r=!1;else if(r==="NaN")r=NaN;else if(!isNaN(o=+r))r=o;else if(n=r.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/))G&&n[4]&&!n[7]&&(r=r.replace(/-/g,"/").replace(/T/," ")),r=new Date(r);else continue;e[t]=r}return e}const G=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function V(e){return e}function Y(e){if(e==null)return V;var t,r,o=e.scale[0],n=e.scale[1],u=e.translate[0],l=e.translate[1];return function(m,y){y||(t=r=0);var h=2,s=m.length,a=new Array(s);for(a[0]=(t+=m[0])*o+u,a[1]=(r+=m[1])*n+l;h<s;)a[h]=m[h],++h;return a}}function J(e,t){for(var r,o=e.length,n=o-t;n<--o;)r=e[n],e[n++]=e[o],e[o]=r}function K(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(r){return M(e,r)})}:M(e,t)}function M(e,t){var r=t.id,o=t.bbox,n=t.properties==null?{}:t.properties,u=Q(e,t);return r==null&&o==null?{type:"Feature",properties:n,geometry:u}:o==null?{type:"Feature",id:r,properties:n,geometry:u}:{type:"Feature",id:r,bbox:o,properties:n,geometry:u}}function Q(e,t){var r=Y(e.transform),o=e.arcs;function n(s,a){a.length&&a.pop();for(var i=o[s<0?~s:s],p=0,c=i.length;p<c;++p)a.push(r(i[p],p));s<0&&J(a,c)}function u(s){return r(s)}function l(s){for(var a=[],i=0,p=s.length;i<p;++i)n(s[i],a);return a.length<2&&a.push(a[0]),a}function m(s){for(var a=l(s);a.length<4;)a.push(a[0]);return a}function y(s){return s.map(m)}function h(s){var a=s.type,i;switch(a){case"GeometryCollection":return{type:a,geometries:s.geometries.map(h)};case"Point":i=u(s.coordinates);break;case"MultiPoint":i=s.coordinates.map(u);break;case"LineString":i=l(s.arcs);break;case"MultiLineString":i=s.arcs.map(l);break;case"Polygon":i=y(s.arcs);break;case"MultiPolygon":i=s.arcs.map(y);break;default:return null}return{type:a,coordinates:i}}return h(t)}async function re(e,t=window.fetch){let o=await(await t(e)).text(),n=_(o,B),u=n.columns.filter(l=>n[0][l]&&n[0][l].includes("|"));return n.forEach((l,m)=>{u.forEach(y=>{l[y]=l[y].split("|")})}),n}async function te(e,t=window.fetch){try{let r=e.slice(0,3),n=await(await t(`${P}/${r}/${e}.json`)).json();n.properties.children=n.properties.children.map(l=>l.hclnm?{areacd:l.areacd,areanm:l.hclnm}:l.areanm?l:{areacd:l.areacd,areanm:l.areacd}).sort((l,m)=>l.areanm.localeCompare(m.areanm)),I[r]&&(n.properties.typenm=I[r].label);let u=n.properties.children[0]?Array.from(new Set(n.properties.children.map(l=>l.areacd.slice(0,3)))):null;return n.properties.childTypes=u?Array.from(new Set(u.map(l=>S[l]))):[],r==="E12"&&(n.properties.childTypes=n.properties.childTypes.filter(l=>l.key!=="lad"),e==="E12000007"&&(n.properties.childTypes=[{key:"lad",codes:["E09"],label:"borough",plural:"boroughs"},...n.properties.childTypes])),{place:n.properties,type:S[r]}}catch{return{place:null,type:null}}}function q(e,t=null){let r=e.hclnm?e.hclnm:e.areanm?e.areanm:e.areacd,o=r.startsWith("Isle"),n=["E12000001","E12000002","E12000004","E12000005","E12000006","E12000008","E12000009","E09000001","E07000035"].includes(e.areacd)||r.startsWith("Vale of");return r=r.replace("&","and").replace(", City of","").replace(", County of",""),["in","the"].includes(t)&&(o||n)&&(r="the "+r),t==="in"&&(o?r="on "+r:r="in "+r),r}function R(e,t){for(const r of t){let o=r.areacd.slice(0,3);if(e.includes(o))return r.groupcd=S[o].key,r}return null}function ne(e,t){let r=[],o=[];return e.forEach(n=>{let u=R(n.geocodes,t.parents);n.geocodes.includes(t.typecd)?r.push({...n,place:t}):u&&o.push({...n,place:R(n.geocodes,t.parents)})}),[...r,...o]}function ae(e,t){let r=e,o=e.match(new RegExp(/\{(.*?)\}/g));return Array.isArray(o)&&o.forEach(n=>{if(n.includes("name")){let u=n.slice(1,-1).split(",")[1];r=r.replace(n,q(t,u))}else r=r.replace(n,t[n.slice(1,-1)])}),r}function oe(e){return e==="output area"?e="Output Area":e==="lower layer super output area"?e="Lower layer Super Output Area (LSOA)":e==="middle layer super output area"&&(e="Middle layer Super Output Area (MSOA)"),!e.startsWith("unit")&&["a","e","i","o","u"].includes(e[0].toLowerCase())?"an "+e:"a "+e}function ie(e){return["K04","E92","W92","E10","E11","E12","E06","E07","E08","E09","W06"].includes(e.slice(0,3))?e+"/":"area/?code="+e}function se(e,t){return e.children.filter(r=>t.codes.includes(r.areacd.slice(0,3)))}function le(e,t){return K(e,t)}function ue(e){return e[0].toUpperCase()+e.slice(1)}export{I as a,S as b,ue as c,X as d,U as e,ee as f,re as g,q as h,te as i,oe as j,ne as k,le as l,ie as m,se as n,ae as p};
