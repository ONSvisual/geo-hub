import{g as F}from"./index.c6f66d7c.js";var G={},j={},A=34,k=10,z=13;function D(e){return new Function("d","return {"+e.map(function(r,t){return JSON.stringify(r)+": d["+t+'] || ""'}).join(",")+"}")}function M(e,r){var t=D(e);return function(a,n){return r(t(a),n,e)}}function P(e){var r=Object.create(null),t=[];return e.forEach(function(a){for(var n in a)n in r||t.push(r[n]=n)}),t}function f(e,r){var t=e+"",a=t.length;return a<r?new Array(r-a+1).join(0)+t:t}function $(e){return e<0?"-"+f(-e,6):e>9999?"+"+f(e,6):f(e,4)}function I(e){var r=e.getUTCHours(),t=e.getUTCMinutes(),a=e.getUTCSeconds(),n=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":$(e.getUTCFullYear())+"-"+f(e.getUTCMonth()+1,2)+"-"+f(e.getUTCDate(),2)+(n?"T"+f(r,2)+":"+f(t,2)+":"+f(a,2)+"."+f(n,3)+"Z":a?"T"+f(r,2)+":"+f(t,2)+":"+f(a,2)+"Z":t||r?"T"+f(r,2)+":"+f(t,2)+"Z":"")}function K(e){var r=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function a(o,s){var p,c,d=n(o,function(b,g){if(p)return p(b,g-1);c=b,p=s?M(b,s):D(b)});return d.columns=c||[],d}function n(o,s){var p=[],c=o.length,d=0,b=0,g,T=c<=0,E=!1;o.charCodeAt(c-1)===k&&--c,o.charCodeAt(c-1)===z&&--c;function O(){if(T)return j;if(E)return E=!1,G;var C,S=d,v;if(o.charCodeAt(S)===A){for(;d++<c&&o.charCodeAt(d)!==A||o.charCodeAt(++d)===A;);return(C=d)>=c?T=!0:(v=o.charCodeAt(d++))===k?E=!0:v===z&&(E=!0,o.charCodeAt(d)===k&&++d),o.slice(S+1,C-1).replace(/""/g,'"')}for(;d<c;){if((v=o.charCodeAt(C=d++))===k)E=!0;else if(v===z)E=!0,o.charCodeAt(d)===k&&++d;else if(v!==t)continue;return o.slice(S,C)}return T=!0,o.slice(S,c)}for(;(g=O())!==j;){for(var w=[];g!==G&&g!==j;)w.push(g),g=O();s&&(w=s(w,b++))==null||p.push(w)}return p}function i(o,s){return o.map(function(p){return s.map(function(c){return l(p[c])}).join(e)})}function u(o,s){return s==null&&(s=P(o)),[s.map(l).join(e)].concat(i(o,s)).join(`
`)}function y(o,s){return s==null&&(s=P(o)),i(o,s).join(`
`)}function h(o){return o.map(m).join(`
`)}function m(o){return o.map(l).join(e)}function l(o){return o==null?"":o instanceof Date?I(o):r.test(o+="")?'"'+o.replace(/"/g,'""')+'"':o}return{parse:a,parseRows:n,format:u,formatBody:y,formatRows:h,formatRow:m,formatValue:l}}var _=K(","),Z=_.parse;function B(e){for(var r in e){var t=e[r].trim(),a,n;if(!t)t=null;else if(t==="true")t=!0;else if(t==="false")t=!1;else if(t==="NaN")t=NaN;else if(!isNaN(a=+t))t=a;else if(n=t.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/))H&&n[4]&&!n[7]&&(t=t.replace(/-/g,"/").replace(/T/," ")),t=new Date(t);else continue;e[r]=t}return e}const H=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function Y(e){return e}function J(e){if(e==null)return Y;var r,t,a=e.scale[0],n=e.scale[1],i=e.translate[0],u=e.translate[1];return function(y,h){h||(r=t=0);var m=2,l=y.length,o=new Array(l);for(o[0]=(r+=y[0])*a+i,o[1]=(t+=y[1])*n+u;m<l;)o[m]=y[m],++m;return o}}function V(e,r){for(var t,a=e.length,n=a-r;n<--a;)t=e[n],e[n++]=e[a],e[a]=t}function Q(e,r){return typeof r=="string"&&(r=e.objects[r]),r.type==="GeometryCollection"?{type:"FeatureCollection",features:r.geometries.map(function(t){return R(e,t)})}:R(e,r)}function R(e,r){var t=r.id,a=r.bbox,n=r.properties==null?{}:r.properties,i=q(e,r);return t==null&&a==null?{type:"Feature",properties:n,geometry:i}:a==null?{type:"Feature",id:t,properties:n,geometry:i}:{type:"Feature",id:t,bbox:a,properties:n,geometry:i}}function q(e,r){var t=J(e.transform),a=e.arcs;function n(l,o){o.length&&o.pop();for(var s=a[l<0?~l:l],p=0,c=s.length;p<c;++p)o.push(t(s[p],p));l<0&&V(o,c)}function i(l){return t(l)}function u(l){for(var o=[],s=0,p=l.length;s<p;++s)n(l[s],o);return o.length<2&&o.push(o[0]),o}function y(l){for(var o=u(l);o.length<4;)o.push(o[0]);return o}function h(l){return l.map(y)}function m(l){var o=l.type,s;switch(o){case"GeometryCollection":return{type:o,geometries:l.geometries.map(m)};case"Point":s=i(l.coordinates);break;case"MultiPoint":s=l.coordinates.map(i);break;case"LineString":s=u(l.arcs);break;case"MultiLineString":s=l.arcs.map(u);break;case"Polygon":s=h(l.arcs);break;case"MultiPolygon":s=l.arcs.map(h);break;default:return null}return{type:o,coordinates:s}}return m(r)}const ae="https://www.ons.gov.uk/visualisations/areas",X="https://ons-dp-prod-cdn.s3.eu-west-2.amazonaws.com/maptiles/ap-geos/v2",ee={W04:{label:"community",plural:"communities",childGroup:!0},E06:{label:"unitary authority",plural:"unitary authorities"},W06:{label:"unitary authority",plural:"unitary authorities",childGroup:!0},E07:{label:"non-metropolitan district",plural:"non-metropolitan districts",childGroup:!0},E08:{label:"metropolitan district",plural:"metropolitan districts"},E09:{label:"borough",plural:"boroughs",childGroup:!0},E10:{label:"county",plural:"counties"},E11:{label:"metropolitan county",plural:"metropolital counties"},S12:{label:"council area",plural:"council areas",childGroup:!0},N09:{label:"local government district",plural:"local government districts",childGroup:!0}},ie=["E00","W00","E01","W01","E02","W02","E04","W04","E05","W05"],se=["E06","E07","E08","E09","E10","E12","E47","E92","N09","N92","S12","S92","W06","W92"],re=[{id:"uk",type:"geojson"},{id:"ctry",type:"geojson"},{id:"rgn",type:"geojson"},{id:"la",type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2023/authorities-all/v1/boundaries/{z}/{x}/{y}.pbf",layer:"boundaries",minzoom:4},{id:"wpc",type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2010/wpc/v2/boundaries/{z}/{x}/{y}.pbf",layer:"boundaries",minzoom:4},{id:"sener",type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2022/sen/v1/boundaries/{z}/{x}/{y}.pbf",layer:"region"},{id:"senc",type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2022/sen/v1/boundaries/{z}/{x}/{y}.pbf",layer:"constituency"},{id:"wd",type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2023/wd/v1/boundaries/{z}/{x}/{y}.pbf",layer:"boundaries",minzoom:6},{id:"par",type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2022/par/v1/boundaries/{z}/{x}/{y}.pbf",layer:"par",minzoom:6},{id:"msoa",type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/msoa/v2/boundaries/{z}/{x}/{y}.pbf",layer:"msoa",minzoom:6},{id:"lsoa",type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/lsoa/v2/boundaries/{z}/{x}/{y}.pbf",layer:"lsoa",minzoom:7},{id:"oa",type:"vector",url:"https://cdn.ons.gov.uk/maptiles/administrative/2021/oa/v2/boundaries/{z}/{x}/{y}.pbf",layer:"oa",minzoom:8}],x=e=>e.map(r=>["!",["in",r,["get","areacd"]]]),N=[{key:"uk",codes:["K02"],source:"uk"},{key:"ctry",codes:["E92","S92","N92","W92"],pcio:"country",label:"country",plural:"countries",source:"ctry"},{key:"rgn",codes:["E12"],pcio:"region",label:"region",plural:"regions",source:"rgn"},{key:"cauth",codes:["E06","E09","E10","E47","N09","S12","W06"],label:"upper-tier/combined authority",plural:"upper-tier/combined authorities",source:"la",filter:["all",...x(["E07","E08"]),["!",["==",["get","cauth"],"true"]]]},{key:"utla",codes:["E06","E08","E09","E10","N09","S12","W06"],pcio:"admin_county",label:"upper-tier/unitary authority",plural:"upper-tier/unitary authorities",source:"la",filter:["all",...x(["E07","E47"])]},{key:"ltla",codes:["E06","E07","E08","E09","N09","S12","W06"],pcio:"admin_district",label:"lower-tier/unitary authority",plural:"lower-tier/unitary authorities",source:"la",filter:["all",...x(["E10","E47"])]},{key:"wpc",codes:["E14","N06","S14","W07"],pcio:"parliamentary_constituency",label:"parliamentary constituency",plural:"parliamentary constituencies",source:"wpc"},{key:"sener",codes:["W10"],label:"Senedd electoral region",plural:"Senedd electoral regions",source:"sener"},{key:"senc",codes:["W09"],label:"Senedd constituency",plural:"Senedd constituencies",source:"senc"},{key:"wd",codes:["E05","W05"],pcio:"admin_ward",label:"ward",plural:"wards",source:"wd"},{key:"par",codes:["E04","W04"],pcio:"parish",label:"parish",plural:"parishes",source:"par"},{key:"msoa",codes:["E02","W02"],pcio:"msoa",label:"MSOA",plural:"MSOAs",source:"msoa"},{key:"lsoa",codes:["E01","W01"],pcio:"lsoa",label:"LSOA",plural:"LSOAs",source:"lsoa"},{key:"oa",codes:["E00","W00"],label:"output area",plural:"output areas",source:"oa"}],le=re.map(e=>({...e,layers:N.filter(r=>r.source===e.id)})),W=(()=>{let e={};return N.forEach(r=>r.codes.forEach(t=>{e[t]={...r};const a=ee[t];a!=null&&a.childGroup&&(e[t].label=a.label,e[t].plural=a.plural)})),e})();(()=>{let e={};return N.forEach(r=>e[r.key]=r),e})();const te=(e,r=B)=>Z(e.replace(/\uFEFF/,""),r);async function ue(e,r=window.fetch){let a=await(await r(e)).text(),n=te(a),i=n.columns.filter(u=>{n[0][u]&&String(n[0][u]).includes("|")});return n.forEach((u,y)=>{i.forEach(h=>{u[h]=u[h].split("|")})}),n}function ne(e){let r=Array.from(new Set(e.sort((n,i)=>n.localeCompare(i)).map(n=>W[n]))).filter((n,i,u)=>u.map(y=>y.key).indexOf(n.key)===i);const t=["cauth","utla","ltla"].filter(n=>r.map(i=>i.key).includes(n));t.length>1&&(r=r.filter(n=>!t.slice(1).includes(n.key)));const a=N.map(n=>n.key);return r.sort((n,i)=>a.indexOf(n.key)-a.indexOf(i.key))}async function ce(e,r=window.fetch){if(!e.match(/[EKNSW]\d{8}\b/))return{place:null,type:null,geometry:null};try{let t=e.slice(0,3),n=await(await r(`${X}/${t}/${e}.json`)).json();return n.properties.childTypes=ne(n.properties.child_typecds),{place:n.properties,type:W[t],geometry:n.geometry}}catch(t){return console.debug(t),{place:null,type:null,geometry:null}}}const L=(e,r)=>!r||(!e.start||r>e.start)&&(!e.end||r<=e.end);function U(e,r,t=null){var n;const a=[...e.parents];["E","W"].includes(e.areacd[0])&&a.push({areacd:"K04000001",areanm:"England and Wales"});for(const i of a){let u=i.areacd.slice(0,3);if(r.includes(u)&&L(i,t))return i.groupcd=(n=W[u])!=null&&n.key?W[u].key:"ew",i}return null}function pe(e,r){let t=[],a=[];return e.forEach(n=>{let i=U(r,n.geocodes,n.year);n.geocodes.includes(r.typecd)&&L(r,n.year)?t.push({...n,place:r}):i&&a.push({...n,place:U(r,n.geocodes,n.year)})}),[...t,...a]}function de(e,r){const t=i=>{const u=r[i];return i==="groupcd"&&u==="ltla"?"lad":u};let a=e,n=e.match(new RegExp(/\{(.*?)\}/g));return Array.isArray(n)&&n.forEach(i=>{if(i.includes("name")){let u=i.slice(1,-1).split(",")[1];a=a.replace(i,`${F(r,u,"prefix")} <strong>${F(r)}</strong>`)}else a=a.replace(i,t(i.slice(1,-1)))}),a}function fe(e){return`areas/${e}/`}function ye(e,r){const t=r.key==="msoa"?"hclnm":r.key==="oa"?"areacd":"areanm";return e.children.filter(a=>r.codes.includes(a.areacd.slice(0,3))).sort((a,n)=>a[t].localeCompare(n[t]))}function me(e,r){return Q(e,r)}function he(e){return e[0].toUpperCase()+e.slice(1)}export{ce as a,ae as b,W as c,U as d,se as e,pe as f,ue as g,le as h,me as i,ye as j,N as k,ee as l,fe as m,ie as n,he as o,de as p};
